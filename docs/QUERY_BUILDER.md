# Query Builder 使用指南

## 概述

Query Builder 是 Notion Chart Generator 的進階篩選功能，允許用戶建立複雜的篩選條件來精確控制圖表資料的範圍。

## 功能特色

### 1. 多重篩選組合

- 支援多個篩選組 (Filter Groups)
- 每個組內可包含多個篩選條件
- 組之間使用 AND 邏輯連接

### 2. 邏輯運算符

- **AND**: 所有條件都必須滿足
- **OR**: 任一條件滿足即可

### 3. 屬性類型支援

#### 數字類型 (Number)

- `等於 (=)`: 數值完全相等
- `不等於 (≠)`: 數值不相等
- `大於 (>)`: 數值大於指定值
- `小於 (<)`: 數值小於指定值
- `大於等於 (≥)`: 數值大於或等於指定值
- `小於等於 (≤)`: 數值小於或等於指定值
- `為空`: 欄位沒有值
- `不為空`: 欄位有值

#### 文字類型 (Text/Title/Rich Text)

- `等於`: 文字完全相同
- `不等於`: 文字不相同
- `包含`: 文字包含指定內容
- `不包含`: 文字不包含指定內容
- `開始於`: 文字以指定內容開始
- `結束於`: 文字以指定內容結束
- `為空`: 欄位沒有內容
- `不為空`: 欄位有內容

#### 選擇類型 (Select)

- `等於`: 選擇的選項相同
- `不等於`: 選擇的選項不同
- `為空`: 沒有選擇任何選項
- `不為空`: 有選擇選項

#### 多選類型 (Multi-select)

- `包含`: 包含指定的選項
- `不包含`: 不包含指定的選項
- `為空`: 沒有選擇任何選項
- `不為空`: 有選擇選項

#### 日期類型 (Date)

- `等於`: 日期完全相同
- `不等於`: 日期不同
- `之前`: 日期在指定日期之前
- `之後`: 日期在指定日期之後
- `上週`: 日期在上週範圍內
- `本週`: 日期在本週範圍內
- `下週`: 日期在下週範圍內
- `上月`: 日期在上個月範圍內
- `本月`: 日期在本月範圍內
- `下月`: 日期在下個月範圍內
- `為空`: 沒有設定日期
- `不為空`: 有設定日期

#### 布林類型 (Checkbox)

- `等於`: 勾選狀態相同
- `不等於`: 勾選狀態不同

## 使用方法

### 1. 新增篩選組

1. 點擊「新增篩選組」按鈕
2. 新的篩選組會自動建立並包含一個空白條件

### 2. 設定篩選條件

1. **選擇屬性**: 從下拉選單選擇要篩選的 Notion 資料庫屬性
2. **選擇運算符**: 根據屬性類型，系統會自動顯示適用的運算符
3. **輸入值**: 在條件值欄位輸入篩選的參考值
4. **設定邏輯**: 選擇條件間的邏輯關係 (AND/OR)

### 3. 管理篩選條件

- **新增條件**: 點擊組內的「+」按鈕新增更多條件
- **刪除條件**: 點擊條件右側的「×」按鈕刪除條件
- **刪除組**: 點擊組標題右側的垃圾桶圖示刪除整個組

### 4. 應用篩選

設定完成後，點擊「生成圖表」按鈕，系統會：

1. 將篩選條件轉換為 Notion API 格式
2. 建立包含篩選條件的動態快照
3. 執行篩選後的資料查詢
4. 生成基於篩選結果的圖表

## 實際範例

### 範例 1: 篩選高價產品

```
篩選組 1 (AND):
- 屬性: Price
- 運算符: 大於 (>)
- 值: 1000
```

### 範例 2: 篩選特定狀態的任務

```
篩選組 1 (OR):
- 條件 1: Status 等於 "In Progress"
- 條件 2: Status 等於 "Review"
```

### 範例 3: 複合條件篩選

```
篩選組 1 (AND):
- 條件 1: Category 等於 "Electronics"
- 條件 2: Price 大於 500

篩選組 2 (AND):
- 條件 1: Status 不等於 "Archived"
- 條件 2: Created Date 本月
```

## 技術說明

### Notion API 整合

Query Builder 產生的篩選條件會自動轉換為 Notion API 的篩選格式：

```javascript
{
  "and": [
    {
      "property": "Price",
      "number": {
        "greater_than": 1000
      }
    }
  ]
}
```

### 動態快照支援

篩選條件會與其他圖表設定一起儲存在動態快照中，確保：

- 每次載入圖表時都使用相同的篩選條件
- 分享的圖表連結包含完整的篩選設定
- 資料更新時仍保持篩選邏輯

## 注意事項

1. **必填條件**: 屬性和運算符為必填項目，值欄位依運算符而定
2. **最少條件**: 每個篩選組至少需要一個完整的條件
3. **效能考量**: 複雜的篩選條件可能影響查詢效能，建議適度使用
4. **資料相容性**: 請確保篩選值與 Notion 資料庫中的實際資料格式相符

## 疑難排解

### 常見問題

**Q: 為什麼篩選條件沒有生效？**
A: 請檢查：

- 屬性名稱是否正確
- 運算符是否適用於該屬性類型
- 篩選值格式是否正確

**Q: 如何篩選空白欄位？**
A: 使用「為空」或「不為空」運算符，這些運算符不需要輸入值。

**Q: 日期篩選如何使用？**
A: 日期值請使用 ISO 格式 (YYYY-MM-DD) 或選擇相對日期選項如「本週」、「本月」等。
